"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[365],{68365:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Fe});var r=n(32735),i=n(12788),o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};var l=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},u="object"==typeof c&&c&&c.Object===Object&&c,p="object"==typeof self&&self&&self.Object===Object&&self,f=u||p||Function("return this")(),d=f,m=function(){return d.Date.now()},v=/\s/;var g=function(e){for(var t=e.length;t--&&v.test(e.charAt(t)););return t},E=/^\s+/;var w=function(e){return e?e.slice(0,g(e)+1).replace(E,""):e},I=f.Symbol,h=I,b=Object.prototype,y=b.hasOwnProperty,S=b.toString,O=h?h.toStringTag:void 0;var T=function(e){var t=y.call(e,O),n=e[O];try{e[O]=void 0;var r=!0}catch(e){}var i=S.call(e);return r&&(t?e[O]=n:delete e[O]),i},x=Object.prototype.toString;var C=T,D=function(e){return x.call(e)},R="[object Null]",M="[object Undefined]",V=I?I.toStringTag:void 0;var A=function(e){return null==e?void 0===e?M:R:V&&V in Object(e)?C(e):D(e)},N=function(e){return null!=e&&"object"==typeof e},_="[object Symbol]";var L=w,P=l,Z=function(e){return"symbol"==typeof e||N(e)&&A(e)==_},j=NaN,H=/^[-+]0x[0-9a-f]+$/i,k=/^0b[01]+$/i,W=/^0o[0-7]+$/i,G=parseInt;var F=l,z=m,U=function(e){if("number"==typeof e)return e;if(Z(e))return j;if(P(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=P(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=L(e);var n=k.test(e);return n||W.test(e)?G(e.slice(2),n?2:8):H.test(e)?j:+e},B="Expected a function",K=Math.max,q=Math.min;var $=function(e,t,n){var r,i,o,a,s,c,l=0,u=!1,p=!1,f=!0;if("function"!=typeof e)throw new TypeError(B);function d(t){var n=r,o=i;return r=i=void 0,l=t,a=e.apply(o,n)}function m(e){var n=e-c;return void 0===c||n>=t||n<0||p&&e-l>=o}function v(){var e=z();if(m(e))return g(e);s=setTimeout(v,function(e){var n=t-(e-c);return p?q(n,o-(e-l)):n}(e))}function g(e){return s=void 0,f&&r?d(e):(r=i=void 0,a)}function E(){var e=z(),n=m(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(v,t),u?d(e):a}(c);if(p)return clearTimeout(s),s=setTimeout(v,t),d(c)}return void 0===s&&(s=setTimeout(v,t)),a}return t=U(t)||0,F(n)&&(u=!!n.leading,o=(p="maxWait"in n)?K(U(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),E.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=c=i=s=void 0},E.flush=function(){return void 0===s?a:g(z())},E},J=$,Y=l,Q="Expected a function";var X=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError(Q);return Y(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),J(e,t,{leading:r,maxWait:t,trailing:i})},ee=function(e,t,n,r){switch(t){case"debounce":return $(e,n,r);case"throttle":return X(e,n,r);default:return e}},te=function(e){return"function"==typeof e},ne=function(){return"undefined"==typeof window},re=function(e){return e instanceof Element||e instanceof HTMLDocument},ie=function(e,t,n,r){return function(i){var o=i.width,a=i.height;t((function(t){return t.width===o&&t.height===a||t.width===o&&!r||t.height===a&&!n?t:(e&&te(e)&&e(o,a),{width:o,height:a})}))}},oe=function(e){function t(t){var n=e.call(this,t)||this;n.cancelHandler=function(){n.resizeHandler&&n.resizeHandler.cancel&&(n.resizeHandler.cancel(),n.resizeHandler=null)},n.attachObserver=function(){var e=n.props,t=e.targetRef,r=e.observerOptions;if(!ne()){t&&t.current&&(n.targetRef.current=t.current);var i=n.getElement();i&&(n.observableElement&&n.observableElement===i||(n.observableElement=i,n.resizeObserver.observe(i,r)))}},n.getElement=function(){var e=n.props,t=e.querySelector,r=e.targetDomEl;if(ne())return null;if(t)return document.querySelector(t);if(r&&re(r))return r;if(n.targetRef&&re(n.targetRef.current))return n.targetRef.current;var o=(0,i.findDOMNode)(n);if(!o)return null;switch(n.getRenderType()){case"renderProp":case"childFunction":case"child":case"childArray":return o;default:return o.parentElement}},n.createResizeHandler=function(e){var t=n.props,r=t.handleWidth,i=void 0===r||r,o=t.handleHeight,a=void 0===o||o,s=t.onResize;if(i||a){var c=ie(s,n.setState.bind(n),i,a);e.forEach((function(e){var t=e&&e.contentRect||{},r=t.width,i=t.height;!n.skipOnMount&&!ne()&&c({width:r,height:i}),n.skipOnMount=!1}))}},n.getRenderType=function(){var e=n.props,t=e.render,i=e.children;return te(t)?"renderProp":te(i)?"childFunction":(0,r.isValidElement)(i)?"child":Array.isArray(i)?"childArray":"parent"};var o=t.skipOnMount,a=t.refreshMode,s=t.refreshRate,c=void 0===s?1e3:s,l=t.refreshOptions;return n.state={width:void 0,height:void 0},n.skipOnMount=o,n.targetRef=(0,r.createRef)(),n.observableElement=null,ne()||(n.resizeHandler=ee(n.createResizeHandler,a,c,l),n.resizeObserver=new window.ResizeObserver(n.resizeHandler)),n}return a(t,e),t.prototype.componentDidMount=function(){this.attachObserver()},t.prototype.componentDidUpdate=function(){this.attachObserver()},t.prototype.componentWillUnmount=function(){ne()||(this.resizeObserver.disconnect(),this.cancelHandler())},t.prototype.render=function(){var e,t=this.props,n=t.render,i=t.children,o=t.nodeType,a=void 0===o?"div":o,c=this.state,l={width:c.width,height:c.height,targetRef:this.targetRef};switch(this.getRenderType()){case"renderProp":return n&&n(l);case"childFunction":return(e=i)(l);case"child":if((e=i).type&&"string"==typeof e.type){var u=s(l,["targetRef"]);return(0,r.cloneElement)(e,u)}return(0,r.cloneElement)(e,l);case"childArray":return(e=i).map((function(e){return!!e&&(0,r.cloneElement)(e,l)}));default:return r.createElement(a,null)}},t}(r.PureComponent);ne()?r.useEffect:r.useLayoutEffect;var ae=n(60216),se=n.n(ae),ce=n(33477),le=n(98336),ue=n(509),pe=n(76467),fe=n(96720),de=n(18359),me=n(84944),ve=n(14360),ge=n(21922),Ee=n(25197),we=n(14284),Ie=n(12494);function he(e){let{viewportData:t,viewportIndex:n,element:i,imageSliceData:o,setImageSliceData:a,scrollbarHeight:s,servicesManager:c}=e;const{cineService:l,cornerstoneViewportService:u}=c.services;return(0,r.useEffect)((()=>{if(!t)return;const e=u.getCornerstoneViewportByIndex(n);if(e)if(t.viewportType!==Ee.Z.STACK){if(t.viewportType===Ee.Z.ORTHOGRAPHIC){const t=we.Z(e);if(!t)return;const{imageIndex:n,numberOfSlices:r}=t;a({imageIndex:n,numberOfSlices:r})}}else{const n=e.getCurrentImageIdIndex();a({imageIndex:n,numberOfSlices:t.data.imageIds.length})}}),[n,t]),(0,r.useEffect)((()=>{if(t?.viewportType!==Ee.Z.STACK)return;const e=e=>{const{newImageIdIndex:n}=e.detail;a({imageIndex:n,numberOfSlices:t.data.imageIds.length})};return i.addEventListener(pe.Z.STACK_VIEWPORT_SCROLL,e),()=>{i.removeEventListener(pe.Z.STACK_VIEWPORT_SCROLL,e)}}),[t,i]),(0,r.useEffect)((()=>{if(t?.viewportType!==Ee.Z.ORTHOGRAPHIC)return;const e=e=>{const{imageIndex:t,numberOfSlices:n}=e.detail;a({imageIndex:t,numberOfSlices:n})};return i.addEventListener(pe.Z.VOLUME_NEW_IMAGE,e),()=>{i.removeEventListener(pe.Z.VOLUME_NEW_IMAGE,e)}}),[t,i]),r.createElement(Ie.Ln,{onChange:e=>((e,t)=>{const n=u.getViewportInfoByIndex(t).getViewportId(),r=u.getCornerstoneViewport(n),{isCineEnabled:o}=l.getState();o&&(l.stopClip(i),l.setCine({id:t,isPlaying:!1})),ce.Z(r.element,{imageIndex:e,debounceLoading:!0})})(e,n),max:o.numberOfSlices?o.numberOfSlices-1:0,height:s,value:o.imageIndex})}he.propTypes={viewportData:se().object,viewportIndex:se().number.isRequired,element:se().instanceOf(Element),scrollbarHeight:se().string,imageSliceData:se().object.isRequired,setImageSliceData:se().func.isRequired,servicesManager:se().object.isRequired};const be=he;var ye=n(6807),Se=n(51567),Oe=n(71478),Te=n(25825);const xe=1e-4;function Ce(e){let{element:t,viewportData:n,imageSliceData:i,viewportIndex:o,servicesManager:a}=e;const{cornerstoneViewportService:s,toolbarService:c}=a.services,[l,u]=(0,r.useState)({windowCenter:null,windowWidth:null}),[p,f]=(0,r.useState)(1),[d,m]=(0,r.useState)([]);(0,r.useEffect)((()=>{m(c.getActiveTools())}),[]),(0,r.useEffect)((()=>{let e=!0;const{unsubscribe:t}=c.subscribe(c.EVENTS.TOOL_BAR_STATE_MODIFIED,(()=>{e&&m(c.getActiveTools())}));return()=>{e=!1,t()}}),[]),(0,r.useEffect)((()=>{const e=e=>{const{range:t}=e.detail;if(!t)return;const{lower:n,upper:r}=t,{windowWidth:i,windowCenter:o}=Se.toWindowLevel(n,r);u({windowCenter:o,windowWidth:i})};return t.addEventListener(pe.Z.VOI_MODIFIED,e),()=>{t.removeEventListener(pe.Z.VOI_MODIFIED,e)}}),[o,n,l,t]),(0,r.useEffect)((()=>{const e=e=>{const{previousCamera:n,camera:r}=e.detail;if(n.parallelScale!==r.parallelScale||n.scale!==r.scale){const e=s.getCornerstoneViewportByIndex(o);if(!e)return;const n=e.getImageData();if(!n)return;if(r.scale)return void f(r.scale);const{spacing:i}=n,a=t.clientHeight*i[0]*.5/r.parallelScale;f(a)}};return t.addEventListener(pe.Z.CAMERA_MODIFIED,e),()=>{t.removeEventListener(pe.Z.CAMERA_MODIFIED,e)}}),[o,n]);const v=(0,r.useCallback)((()=>{const{windowWidth:e,windowCenter:t}=l;return d.includes("WindowLevel")?"number"!=typeof t||"number"!=typeof e?null:r.createElement("div",{className:"flex flex-row text-base"},r.createElement("span",{className:"mr-1"},"W:"),r.createElement("span",{className:"ml-1 mr-2 font-light"},e.toFixed(0)),r.createElement("span",{className:"mr-1"},"L:"),r.createElement("span",{className:"ml-1 font-light"},t.toFixed(0))):d.includes("Zoom")?r.createElement("div",{className:"flex flex-row text-base"},r.createElement("span",{className:"mr-1"},"Zoom:"),r.createElement("span",{className:"font-light"},p.toFixed(2),"x")):null}),[l,p,d]),g=(0,r.useCallback)((()=>{const{imageIndex:e,numberOfSlices:t}=i;if(!n)return;let a;if(n.viewportType===Ee.Z.STACK){if(a=function(e,t){const n=e.data.imageIds,r=n[t];if(!r)return;const i=Oe.get("generalImageModule",r)||{},{instanceNumber:o}=i;if(n.length<=1)return;return parseInt(o)}(n,e),!a)return null}else n.viewportType===Ee.Z.ORTHOGRAPHIC&&(a=function(e,t,n,r){const i=e.volumes;if(!i||i.length>1)return;const o=i[0],{direction:a,imageIds:s}=o,c=r.getCornerstoneViewportByIndex(n);if(!c)return;const l=c.getCamera(),{viewPlaneNormal:u}=l,p=a.slice(6,9),f=ye.cross(ye.create(),u,p);if(ye.length(f)<xe){const e=s[t];if(!e)return{};const{instanceNumber:n}=Oe.get("generalImageModule",e)||{};return parseInt(n)}}(n,e,o,s));return r.createElement("div",{className:"flex flex-row text-base"},r.createElement("span",{className:"mr-1"},"I:"),r.createElement("span",{className:"font-light"},void 0!==a?`${a} (${e+1}/${t})`:`${e+1}/${t}`))}),[i,n,o]);if(!n)return null;const E=s.getViewportInfoByIndex(o);if(!E)return null;const w=E.getViewportOptions().background,I=!!w&&me.Z(w,[1,1,1]);return r.createElement(Ie.No,{topLeft:v(),topRight:g(),color:I&&"text-[#0944B3]"})}Ce.propTypes={viewportData:se().object,imageIndex:se().number,viewportIndex:se().number,servicesManager:se().instanceOf(Te.Z)};const De=Ce;var Re=n(40841),Me=n.n(Re),Ve=n(9566);const{getOrientationStringLPS:Ae,invertOrientationStringLPS:Ne}=Ve;function _e(e){let{element:t,viewportData:n,imageSliceData:i,viewportIndex:o,servicesManager:a,orientationMarkers:s=["top","left"]}=e;const[c,l]=(0,r.useState)(0),[u,p]=(0,r.useState)(!1),[f,d]=(0,r.useState)(!1),{cornerstoneViewportService:m}=a.services;(0,r.useEffect)((()=>{const e=e=>{const{rotation:t,previousCamera:n,camera:r}=e.detail;void 0!==t&&l(t),void 0!==r.flipHorizontal&&n.flipHorizontal!==r.flipHorizontal&&p(r.flipHorizontal),void 0!==r.flipVertical&&n.flipVertical!==r.flipVertical&&d(r.flipVertical)};return t.addEventListener(pe.Z.CAMERA_MODIFIED,e),()=>{t.removeEventListener(pe.Z.CAMERA_MODIFIED,e)}}),[]);const v=(0,r.useMemo)((()=>{if(!n)return"";let e,a;if("stack"===n.viewportType){const t=i.imageIndex,r=n.data.imageIds?.[t];if(!r)return!1;({rowCosines:e,columnCosines:a}=Oe.get("imagePlaneModule",r)||{})}else{if(!t||!(0,fe.ZP)(t))return"";const{viewport:n}=(0,fe.ZP)(t),{viewUp:r,viewPlaneNormal:i}=n.getCamera(),o=ye.create();ye.cross(o,r,i),a=[-r[0],-r[1],-r[2]],e=o}if(!e||!a||void 0===c)return"";const l=function(e,t,n,r,i){const o=Ae(e),a=Ae(t),s=Ne(o),c={top:Ne(a),left:s,right:o,bottom:a};r&&(c.top=Ne(c.top),c.bottom=Ne(c.bottom));i&&(c.left=Ne(c.left),c.right=Ne(c.right));if(90===n||-270===n)return{top:c.left,left:Ne(c.top),right:Ne(c.bottom),bottom:c.right};if(-90===n||270===n)return{top:Ne(c.left),left:c.top,bottom:c.left,right:c.bottom};if(180===n||-180===n)return{top:Ne(c.top),left:Ne(c.left),bottom:Ne(c.bottom),right:Ne(c.right)};return c}(e,a,c,f,u),p=m.getViewportInfoByIndex(o).getViewportOptions().background,d=!!p&&me.Z(p,[1,1,1]);return s.map(((e,t)=>r.createElement("div",{className:Me()(`${e}-mid orientation-marker`,d?"text-[#726F7E]":"text-[#ccc]"),key:`${e}-mid orientation-marker`},r.createElement("div",{className:"orientation-marker-value"},l[e]))))}),[n,i,c,f,u,s,t]);return r.createElement("div",{className:"ViewportOrientationMarkers noselect"},v)}_e.propTypes={percentComplete:se().number,error:se().object},_e.defaultProps={percentComplete:0,error:null};const Le=_e;function Pe(e){let{viewportData:t,element:n}=e;const[i,o]=(0,r.useState)(!1),[a,s]=(0,r.useState)(!1),c=(0,r.useRef)(null),l=(0,r.useRef)(null),u=e=>{clearTimeout(c.current),c.current=setTimeout((()=>{o(!0)}),50)},p=e=>{clearTimeout(c.current),o(!1)},f=e=>{clearTimeout(c.current),l.current===e.detail.imageId&&(s(e.detail.error),l.current=null)};return(0,r.useEffect)((()=>(n.addEventListener(pe.Z.STACK_VIEWPORT_SCROLL,u),n.addEventListener(pe.Z.IMAGE_LOAD_ERROR,f),n.addEventListener(pe.Z.STACK_NEW_IMAGE,p),()=>{n.removeEventListener(pe.Z.STACK_VIEWPORT_SCROLL,u),n.removeEventListener(pe.Z.STACK_NEW_IMAGE,p),n.removeEventListener(pe.Z.IMAGE_LOAD_ERROR,f)})),[n,t]),a?r.createElement(r.Fragment,null,r.createElement("div",{className:"bg-black opacity-50 absolute h-full w-full top-0 left-0"},r.createElement("div",{className:"flex transparent items-center justify-center w-full h-full"},r.createElement("p",{className:"text-primary-light text-xl font-light"},r.createElement("h4",null,"Error Loading Image"),r.createElement("p",null,"An error has occurred."),r.createElement("p",null,a))))):i?r.createElement("div",{className:"pointer-events-none bg-black opacity-50 absolute h-full w-full top-0 left-0"},r.createElement("div",{className:"flex transparent items-center justify-center w-full h-full"},r.createElement("p",{className:"text-primary-light text-xl font-light"},"Loading..."))):null}Pe.propTypes={percentComplete:se().number,error:se().object,element:se().object},Pe.defaultProps={percentComplete:0,error:null};const Ze=Pe;const je=function(e){const{viewportIndex:t,element:n,scrollbarHeight:i,servicesManager:o}=e,{cornerstoneViewportService:a}=o.services,[s,c]=(0,r.useState)({imageIndex:0,numberOfSlices:0}),[l,u]=(0,r.useState)(null);if((0,r.useEffect)((()=>{const{unsubscribe:e}=a.subscribe(a.EVENTS.VIEWPORT_DATA_CHANGED,(e=>{e.viewportIndex===t&&u(e.viewportData)}));return()=>{e()}}),[t]),!n)return null;if(l){if(a.getViewportInfoByIndex(t)?.viewportOptions?.customViewportProps?.hideOverlays)return null}return r.createElement("div",{className:"noselect"},r.createElement(be,{viewportIndex:t,viewportData:l,element:n,imageSliceData:s,setImageSliceData:c,scrollbarHeight:i,servicesManager:o}),r.createElement(De,{imageSliceData:s,viewportData:l,viewportIndex:t,servicesManager:o,element:n}),r.createElement(Ze,{viewportData:l,element:n}),r.createElement(Le,{imageSliceData:s,element:n,viewportData:l,servicesManager:o,viewportIndex:t}))};var He=n(63130);function ke(e,t){if(t.needsRerendering)return!1;if(e.displaySets.length!==t.displaySets.length)return!1;if(e.viewportOptions.orientation!==t.viewportOptions.orientation)return!1;if(e.viewportOptions.toolGroupId!==t.viewportOptions.toolGroupId)return!1;if(e.viewportOptions.viewportType!==t.viewportOptions.viewportType)return!1;const n=e.displaySets,r=t.displaySets;if(n.length!==r.length)return!1;for(let e=0;e<n.length;e++){const t=n[e],i=r.find((e=>e.displaySetInstanceUID===t.displaySetInstanceUID));if(!i)return!1;if(i.images?.length!==t.images?.length)return!1;if(i.images?.length)for(let e=0;e<i.images.length;e++)if(i.images[e].imageId!==t.images[e].imageId)return!1}return!0}const We=r.memo((e=>{const{viewportIndex:t,displaySets:n,dataSource:i,viewportOptions:o,displaySetOptions:a,servicesManager:s,onElementEnabled:c,onElementDisabled:l,initialImageIndex:u}=e,[p,f]=(0,r.useState)("100px"),[{isCineEnabled:d,cines:m},v]=(0,Ie.vQ)(),[{activeViewportIndex:g}]=(0,Ie.O_)(),[E,w]=(0,r.useState)(null),I=(0,r.useRef)(),{measurementService:h,displaySetService:b,toolbarService:y,toolGroupService:S,syncGroupService:O,cornerstoneViewportService:T,cornerstoneCacheService:x,viewportGridService:C}=s.services,D=()=>{if(!m||!m[t]||!E)return;const e=m[t],n=e.isPlaying||!1,r=e.frameRate||24,i=Math.max(r,1);n?v.playClip(E,{framesPerSecond:i}):v.stopClip(E)};(0,r.useEffect)((()=>(ue.Z.addEventListener(pe.Z.STACK_VIEWPORT_NEW_STACK,D),()=>{v.setCine({id:t,isPlaying:!1}),ue.Z.removeEventListener(pe.Z.STACK_VIEWPORT_NEW_STACK,D)})),[E]),(0,r.useEffect)((()=>{if(m&&m[t]&&E)return D(),()=>{E&&m?.[t]?.isPlaying&&v.stopClip(E)}}),[m,t,v,E,D]);const R=m[t],M=R&&R.isPlaying||!1,V=(0,r.useCallback)((()=>{const e=I.current.clientHeight-20+"px";f(e)}),[I]),A=(0,r.useCallback)((()=>{I.current&&(T.resize(),V())}),[I]),N=(0,r.useCallback)((()=>{const e=T.getViewportInfoByIndex(t);if(!e)return;const n=e.getViewportId(),r=e.getRenderingEngineId(),i=e.getSyncGroups();S.removeViewportFromToolGroup(n,r),O.removeViewportFromSyncGroup(n,r,i)}),[t,o.viewportId]),_=(0,r.useCallback)((e=>{if(e.detail.element!==I.current)return;const{viewportId:t,element:n}=e.detail,r=T.getViewportInfo(t),i=r.getViewportIndex();(0,ge.Yc)(i,n),w(n);const o=r.getRenderingEngineId(),a=r.getToolGroupId(),s=r.getSyncGroups();S.addViewportToToolGroup(t,o,a),O.addViewportToSyncGroup(t,o,s),c&&c(e)}),[t,c,S]);return(0,r.useEffect)((()=>(T.enableViewport(t,o,I.current),ue.Z.addEventListener(pe.Z.ELEMENT_ENABLED,_),V(),()=>{if(N(),T.disableElement(t),l){const e=T.getViewportInfoByIndex(t);l(e)}ue.Z.removeEventListener(pe.Z.ELEMENT_ENABLED,_)})),[]),(0,r.useEffect)((()=>{const{unsubscribe:e}=b.subscribe(b.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,(async e=>{const n=T.getViewportInfoByIndex(t);if(n.hasDisplaySet(e)){const r=n.getViewportData(),o=await x.invalidateViewportData(r,e,i,b),a=!0;T.updateViewport(t,o,a)}}));return()=>{e()}}),[t]),(0,r.useEffect)((()=>{o.viewportType||(o.viewportType="stack");(async()=>{const e=await x.createViewportData(n,o,i,u);T.setViewportData(t,e,o,a)})()}),[o,n,i]),(0,r.useEffect)((()=>{const e=function(e,t,n,r,i,o,a){const s=i.map((e=>e.displaySetInstanceUID)),{unsubscribe:c}=e.subscribe(e.EVENTS.JUMP_TO_MEASUREMENT,(i=>{let{measurement:c}=i;c&&s.includes(c.displaySetInstanceUID)&&Ge(c,n,r,e,t,o,a)}));return c}(h,b,I,t,n,C,T);return function(e,t,n,r,i,o,a){const s=i.map((e=>e.displaySetInstanceUID)),c=e.getJumpToMeasurement(r);if(c&&n){const i=e.getMeasurement(c);s.includes(i.displaySetInstanceUID)&&Ge(i,n,r,e,t,o,a)}}(h,b,I,t,n,C,T),()=>{e()}}),[n,I,t]),r.createElement("div",{className:"viewport-wrapper"},r.createElement(oe,{handleWidth:!0,handleHeight:!0,skipOnMount:!0,refreshMode:"debounce",refreshRate:200,onResize:A,targetRef:I.current}),r.createElement("div",{className:"cornerstone-viewport-element",style:{height:"100%",width:"100%"},onContextMenu:e=>e.preventDefault(),onMouseDown:e=>e.preventDefault(),ref:I}),r.createElement(je,{viewportIndex:t,toolbarService:y,element:I.current,scrollbarHeight:p,servicesManager:s}),d&&r.createElement(Ie.H6,{className:"absolute left-1/2 -translate-x-1/2 bottom-3",isPlaying:M,onClose:()=>{y.recordInteraction({groupId:"MoreTools",itemId:"cine",interactionType:"toggle",commands:[{commandName:"toggleCine",commandOptions:{},context:"CORNERSTONE"}]})},onPlayPauseChange:e=>v.setCine({id:g,isPlaying:e}),onFrameRateChange:e=>v.setCine({id:g,frameRate:e})}))}),ke);function Ge(e,t,n,r,i,o,a){const s=t.current,{displaySetInstanceUID:c,SOPInstanceUID:l,frameNumber:u}=e;l||console.warn("cannot jump in a non-acquisition plane measurements yet");const p=i.getDisplaySetByUID(c);o.setActiveViewportIndex(n);const f=(0,fe.ZP)(s),d=a.getViewportInfoByIndex(n);if(f){const t=f.viewport;let i=0,o=!0;if(t instanceof de.Z){i=t.getImageIds().findIndex((e=>{const{SOPInstanceUID:t,frameNumber:n}=(0,He.Z)(e);return t===l&&(!u||u===n)}))}else{const{viewPlaneNormal:t}=e.metadata;i=p.images.findIndex((e=>e.SOPInstanceUID===l));const{orientation:n}=d.getViewportOptions();n&&t&&!me.Z(ve.Z[n]?.viewPlaneNormal,t)&&(o=!1)}if(!o||-1===i)return;ce.Z(s,{imageIndex:i}),le.setAnnotationSelected(e.uid),r.removeJumpToMeasurement(n)}}We.displayName="OHIFCornerstoneViewport",We.propTypes={viewportIndex:se().number.isRequired,displaySets:se().array.isRequired,dataSource:se().object.isRequired,viewportOptions:se().object,displaySetOptions:se().arrayOf(se().any),servicesManager:se().object.isRequired,onElementEnabled:se().func,initialImageIdOrIndex:se().oneOfType([se().string,se().number])};const Fe=We}}]);
//# sourceMappingURL=365.bundle.ace3ec31e187c1beacda.js.map